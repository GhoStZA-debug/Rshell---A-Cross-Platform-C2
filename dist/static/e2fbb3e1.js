import{u as re,a as le,_ as ne}from"./f5f6aa45.js";/* empty css        *//* empty css        *//* empty css        */import{H as de,ay as ie,r as u,_ as O,e as c,d as ce,l as i,m as p,V as o,P as l,p as t,u as d,T as ue,a3 as pe,U as P,O as f,R as v,K as Z,S as D,F as _e,a8 as we,J as E,az as me,aA as fe}from"./95bbca75.js";import{a as g,b as H,d as ve,O as ge,N as he,P as ye,v as xe,w as be,l as Ve,ae as ke,Z as U,H as F,af as N,a4 as q,ag as J}from"./3325456c.js";import{U as Ce}from"./d456fb9d.js";const _=h=>(me("data-v-7c8a946f"),h=h(),fe(),h),Pe={class:"reset-password-container"},Ee=_(()=>t("div",{class:"background-decorations"},[t("div",{class:"decoration-circle circle-1"}),t("div",{class:"decoration-circle circle-2"}),t("div",{class:"decoration-circle circle-3"})],-1)),Se={class:"dialog-header"},ze={class:"header-icon"},Be=_(()=>t("div",{class:"header-content"},[t("h3",{class:"dialog-title"},"重置密码"),t("p",{class:"dialog-subtitle"},"请验证身份并设置新的登录密码")],-1)),Re={class:"dialog-content"},Ue={class:"username-display"},Fe={class:"username-text"},Ne=_(()=>t("div",{class:"form-hint"},"系统管理员账号",-1)),qe={class:"password-input-wrapper"},Ie=_(()=>t("div",{class:"form-hint"},"请输入您当前的登录密码",-1)),Me={class:"password-input-wrapper"},Te={key:0,class:"password-strength-indicator"},$e={class:"strength-meter"},Ae={class:"strength-info"},Oe=_(()=>t("span",{class:"strength-label"},"密码强度：",-1)),Ze={class:"password-requirements"},De={class:"password-input-wrapper"},He={key:0,class:"password-match-indicator"},Je={class:"security-notice"},Ke=_(()=>t("div",{class:"notice-content"},[t("p",{class:"notice-title"},"安全提示"),t("p",{class:"notice-text"}," 为了您的账户安全，请定期更换密码，并确保密码复杂度符合要求。 修改密码后，您需要重新登录系统。 ")],-1)),Le={class:"dialog-footer"},je={key:0},Ge={key:1},Qe=de({__name:"ResetPassword",setup(h){const y=ie(),I=re(),K=le(),x=u(!0),w=u(!1),b=u(!1),V=u(!1),k=u(!1),s=O({username:I.getUserName()||"",password:"",new_password:"",again_password:""}),S=c(()=>{if(!s.new_password)return 0;let r=0;return s.new_password.length>=8&&r++,s.new_password.length>=12&&r++,/[a-z]/.test(s.new_password)&&r++,/[A-Z]/.test(s.new_password)&&r++,/[0-9]/.test(s.new_password)&&r++,/[^a-zA-Z0-9]/.test(s.new_password)&&r++,Math.min(r,5)}),L=c(()=>{const r=S.value;return r<=2?"弱":r<=3?"中":"强"}),M=c(()=>{const r=S.value;return r<=2?"#f56c6c":r<=3?"#e6a23c":"#67c23a"}),T=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[^]{8,}$/,j=c(()=>s.new_password?T.test(s.new_password):!1),m=c(()=>s.new_password===s.again_password),G=(r,e,a)=>{e?e.length<6?a(new Error("密码长度不能小于6位")):a():a(new Error("请输入原密码"))},Q=(r,e,a)=>{e?e.length<8?a(new Error("密码长度不能小于8位")):T.test(e)?a():a(new Error("密码必须包含大小写字母和数字")):a(new Error("请输入新密码"))},W=(r,e,a)=>{e?e!==s.new_password?a(new Error("两次输入的密码不一致")):a():a(new Error("请确认新密码"))},z=u(),X=O({password:[{required:!0,validator:G,trigger:"blur"}],new_password:[{required:!0,validator:Q,trigger:"blur"}],again_password:[{required:!0,validator:W,trigger:"blur"}]});ce(()=>{s.username||(g.error("请先登录"),setTimeout(()=>{y.push("/login")},1500))});const Y=[{text:"至少8个字符",met:c(()=>s.new_password.length>=8)},{text:"至少一个大写字母",met:c(()=>/[A-Z]/.test(s.new_password))},{text:"至少一个小写字母",met:c(()=>/[a-z]/.test(s.new_password))},{text:"至少一个数字",met:c(()=>/[0-9]/.test(s.new_password))}],ee=async()=>{var r,e;w.value=!0;try{const a=await Ce.rest_password({old_password:s.password,new_password:s.new_password});a.data.code===200?(g.success("密码重置成功"),await H.alert("密码重置成功，请使用新密码重新登录","操作成功",{confirmButtonText:"重新登录",type:"success",showClose:!1,closeOnClickModal:!1,closeOnPressEscape:!1}),I.logout(),K.clear(),localStorage.clear(),sessionStorage.clear(),y.push("/login")):g.error(a.data.message||"重置密码失败，请稍后重试")}catch(a){console.error("重置密码失败:",a),g.error(((e=(r=a.response)==null?void 0:r.data)==null?void 0:e.message)||"重置密码失败，请稍后重试")}finally{w.value=!1}},se=async()=>{if(s.password||s.new_password||s.again_password)try{await H.confirm("您有未保存的更改，确定要取消吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),x.value=!1,y.push("/Clients")}catch{}else x.value=!1,y.push("/Clients")},$=r=>{r&&r.validate((e,a)=>{e?ee():g.error("请检查表单信息")})},B=r=>{switch(r){case"old":b.value=!b.value;break;case"new":V.value=!V.value;break;case"confirm":k.value=!k.value;break}};return(r,e)=>{const a=ve,C=ge,R=he,ae=ye,A=xe,te=be;return i(),p("div",Pe,[Ee,o(te,{modelValue:x.value,"onUpdate:modelValue":e[8]||(e[8]=n=>x.value=n),title:"重置密码",width:"520px",class:"reset-password-dialog","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,"destroy-on-close":""},{header:l(()=>[t("div",Se,[t("div",ze,[o(a,{class:"lock-icon"},{default:l(()=>[o(d(Ve))]),_:1})]),Be])]),footer:l(()=>[t("div",Le,[o(A,{onClick:se,class:"footer-button",disabled:w.value},{default:l(()=>[ue(" 取消 ")]),_:1},8,["disabled"]),o(A,{type:"primary",onClick:e[7]||(e[7]=n=>$(z.value)),class:"footer-button",loading:w.value,disabled:!j.value||!m.value},{default:l(()=>[w.value?(i(),p("span",Ge,"处理中...")):(i(),p("span",je,"重置密码"))]),_:1},8,["loading","disabled"])])]),default:l(()=>[t("div",Re,[o(ae,{ref_key:"ruleFormRef",ref:z,model:s,class:"reset-password-form","label-position":"top",rules:X,onSubmit:e[6]||(e[6]=pe(n=>$(z.value),["prevent"]))},{default:l(()=>[o(C,{label:"用户名",class:"form-item-custom"},{default:l(()=>[t("div",Ue,[o(a,{class:"user-icon"},{default:l(()=>[o(d(ke))]),_:1}),t("span",Fe,P(s.username),1)]),Ne]),_:1}),o(C,{label:"原密码",prop:"password",class:"form-item-custom"},{default:l(()=>[t("div",qe,[o(a,{class:"input-icon"},{default:l(()=>[o(d(U))]),_:1}),o(R,{modelValue:s.password,"onUpdate:modelValue":e[0]||(e[0]=n=>s.password=n),type:b.value?"text":"password",placeholder:"请输入当前使用的密码",size:"large",clearable:""},null,8,["modelValue","type"]),o(a,{class:"password-toggle",onClick:e[1]||(e[1]=n=>B("old"))},{default:l(()=>[(i(),f(v(b.value?d(F):d(N))))]),_:1})]),Ie]),_:1}),o(C,{label:"新密码",prop:"new_password",class:"form-item-custom"},{default:l(()=>[t("div",Me,[o(a,{class:"input-icon"},{default:l(()=>[o(d(U))]),_:1}),o(R,{modelValue:s.new_password,"onUpdate:modelValue":e[2]||(e[2]=n=>s.new_password=n),type:V.value?"text":"password",placeholder:"请设置新的登录密码",size:"large",clearable:""},null,8,["modelValue","type"]),o(a,{class:"password-toggle",onClick:e[3]||(e[3]=n=>B("new"))},{default:l(()=>[(i(),f(v(V.value?d(F):d(N))))]),_:1})]),s.new_password?(i(),p("div",Te,[t("div",$e,[t("div",{class:"strength-bar",style:Z({width:`${S.value/5*100}%`,backgroundColor:M.value})},null,4)]),t("div",Ae,[Oe,t("span",{class:"strength-value",style:Z({color:M.value})},P(L.value),5)])])):D("",!0),t("div",Ze,[(i(),p(_e,null,we(Y,(n,oe)=>t("div",{key:oe,class:"requirement-item"},[o(a,{class:E(["requirement-icon",{"requirement-met":n.met.value}])},{default:l(()=>[(i(),f(v(n.met.value?d(q):d(J))))]),_:2},1032,["class"]),t("span",{class:E(["requirement-text",{"requirement-met":n.met.value}])},P(n.text),3)])),64))])]),_:1}),o(C,{label:"确认密码",prop:"again_password",class:"form-item-custom"},{default:l(()=>[t("div",De,[o(a,{class:"input-icon"},{default:l(()=>[o(d(U))]),_:1}),o(R,{modelValue:s.again_password,"onUpdate:modelValue":e[4]||(e[4]=n=>s.again_password=n),type:k.value?"text":"password",placeholder:"请再次输入新密码",size:"large",clearable:""},null,8,["modelValue","type"]),o(a,{class:"password-toggle",onClick:e[5]||(e[5]=n=>B("confirm"))},{default:l(()=>[(i(),f(v(k.value?d(F):d(N))))]),_:1})]),s.again_password?(i(),p("div",He,[o(a,{class:E(["match-icon",{"match-success":m.value}])},{default:l(()=>[(i(),f(v(m.value?d(q):d(J))))]),_:1},8,["class"]),t("span",{class:E(["match-text",{"match-success":m.value}])},P(m.value?"密码匹配成功":"密码不匹配"),3)])):D("",!0)]),_:1})]),_:1},8,["model","rules"]),t("div",Je,[o(a,{class:"notice-icon"},{default:l(()=>[o(d(q))]),_:1}),Ke])])]),_:1},8,["modelValue"])])}}});const os=ne(Qe,[["__scopeId","data-v-7c8a946f"]]);export{os as default};
