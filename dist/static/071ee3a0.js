import{s as T,_ as re}from"./f5f6aa45.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import"./4ed993c7.js";/* empty css        *//* empty css        */import{H as ue,r as k,e as x,d as _e,l as f,m as E,p as t,V as e,P as s,u as d,T as b,U as h,Q as I,O as w,J as N,S as B,a3 as pe,W as H,F as D,a8 as ve,R as me,az as fe,aA as he}from"./95bbca75.js";import{a as i,b as W,d as be,v as ge,z as ye,y as Ae,x as ke,J as Ce,K as Se,L as Le,M as Ve,N as Te,O as we,P as Pe,w as ze,Q as Ee,R as $e,S as xe,T as Ie,U as Ne,D as Be,F as De,n as U,V as Ue,W as Ke,X as Oe,H as Fe,Y as J,l as qe,Z as Me,_ as He,o as We,$ as Je,a0 as Qe,a1 as Re}from"./3325456c.js";const C={addListener(r){return T({url:"/listener/add",method:"POST",data:r})},getListenerList(){return T({url:"/listener/list",method:"GET"})},openListener(r){return T({url:"/listener/open",method:"POST",data:r})},closeListener(r){return T({url:"/listener/close",method:"POST",data:r})},deleteListener(r){return T({url:"/listener/delete",method:"POST",data:r})}},u=r=>(fe("data-v-351f43e4"),r=r(),he(),r),Ge={class:"listener-management"},Xe={class:"header-section"},Ye=u(()=>t("div",{class:"header-content"},[t("h1",{class:"page-title"},"监听器管理"),t("p",{class:"page-subtitle"},"配置和管理远程连接的监听器")],-1)),Ze={class:"stats-cards"},je={class:"stat-content"},es={class:"stat-info"},ss={class:"stat-value"},ts=u(()=>t("div",{class:"stat-label"},"总数",-1)),ls={class:"stat-content"},as={class:"stat-info"},os={class:"stat-value"},ns=u(()=>t("div",{class:"stat-label"},"活跃",-1)),ds={class:"stat-content"},cs={class:"stat-info"},is={class:"stat-value"},rs=u(()=>t("div",{class:"stat-label"},"未启动",-1)),us={class:"table-header"},_s=u(()=>t("h3",{class:"table-title"},"监听器列表",-1)),ps={class:"table-actions"},vs={class:"protocol-cell"},ms={class:"address-cell"},fs={class:"address-content"},hs={class:"address-text"},bs=u(()=>t("div",{class:"address-label"},"监听地址",-1)),gs={class:"address-cell"},ys={class:"address-content"},As={class:"address-text"},ks=u(()=>t("div",{class:"address-label"},"连接地址",-1)),Cs={class:"status-cell"},Ss={class:"action-buttons"},Ls={class:"dialog-content"},Vs={class:"step-content"},Ts=u(()=>t("div",{class:"step-title"},"选择监听协议",-1)),ws={class:"protocol-grid"},Ps=["onClick"],zs={class:"protocol-icon"},Es={class:"protocol-info"},$s={class:"protocol-name"},xs={class:"protocol-desc"},Is={class:"step-content"},Ns=u(()=>t("div",{class:"step-title"},"配置监听参数",-1)),Bs=u(()=>t("div",{class:"form-hint"},"监听地址格式：IP:端口",-1)),Ds=u(()=>t("div",{class:"form-hint"},"客户端连接地址格式：IP:端口",-1)),Us={class:"dialog-footer"},Ks=ue({__name:"listener",setup(r){const S=k([]),p=k(!1),L=k(!1),v=k(0),n=k({protocol:"websocket",listenAddress:"",connectAddress:""}),_=k({endpoint:"oss-cn-hangzhou.aliyuncs.com",bucketName:"alisso"}),Q=[{value:"websocket",label:"Websocket",icon:U,iconClass:"protocol-ws",description:"基于WebSocket的实时通信"},{value:"tcp",label:"TCP",icon:U,iconClass:"protocol-tcp",description:"标准的TCP协议连接"},{value:"kcp",label:"KCP",icon:Qe,iconClass:"protocol-kcp",description:"快速可靠的KCP协议"},{value:"http",label:"HTTP",icon:J,iconClass:"protocol-http",description:"HTTP协议支持"},{value:"oss",label:"OSS",icon:Re,iconClass:"protocol-oss",description:"阿里云OSS存储"}],R=x(()=>S.value.filter(o=>o.Status===1).length),G=x(()=>S.value.filter(o=>o.Status===2).length),K=x(()=>n.value.protocol==="oss"?_.value.endpoint&&n.value.listenAddress&&n.value.connectAddress&&_.value.bucketName:n.value.listenAddress&&n.value.connectAddress),X=o=>({websocket:"primary",tcp:"info",kcp:"warning",http:"success",oss:"danger"})[o]||"info",Y=o=>{n.value.protocol=o,n.value.listenAddress="",n.value.connectAddress="",_.value={endpoint:"oss-cn-hangzhou.aliyuncs.com",bucketName:"alisso"}},Z=()=>"0.0.0.0:8083",j=()=>"外网连接地址 (127.0.0.1:8083)",g=async()=>{p.value=!0;try{const o=await C.getListenerList();o.status===200&&(S.value=o.data.data)}catch(o){console.error("获取监听器列表失败:",o),i.error("获取监听器列表失败")}finally{p.value=!1}},O=async()=>{if(!K.value){i.warning("请填写完整的配置信息");return}p.value=!0;try{let o;if(n.value.protocol==="oss"){const a=`${_.value.endpoint}:${n.value.listenAddress}:${n.value.connectAddress}:${_.value.bucketName}`;o=await C.addListener({type:n.value.protocol,listenAddress:a,connectAddress:a})}else o=await C.addListener({type:n.value.protocol,listenAddress:n.value.listenAddress,connectAddress:n.value.connectAddress});o.status===200&&(o.data.status===200?(i.success("监听器添加成功"),L.value=!1,F(),await g()):i.error(o.data.data||"添加失败"))}catch(o){console.error("添加监听器失败:",o),i.error("添加监听器失败")}finally{p.value=!1}},ee=async o=>{try{const a=await C.openListener({listenAddress:o.ListenAddress});a.data.status===200?(await g(),i.success("监听器启动成功")):i.error(a.data.data||"启动失败")}catch(a){console.error("启动监听器失败:",a),i.error("启动监听器失败")}},se=async o=>{try{const a=await C.closeListener({listenAddress:o.ListenAddress});a.data.status===200?(await g(),i.success("监听器已停止")):i.error(a.data.data||"停止失败")}catch(a){console.error("停止监听器失败:",a),i.error("停止监听器失败")}},te=async o=>{try{await W.confirm(`确定要删除监听器 "${o.ListenAddress}" 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",confirmButtonClass:"delete-confirm-btn"});const a=await C.deleteListener({listenAddress:o.ListenAddress});a.data.status===200?(await g(),i.success("监听器删除成功")):i.error(a.data.data||"删除失败")}catch(a){a!=="cancel"&&(console.error("删除监听器失败:",a),i.error("删除监听器失败"))}},le=o=>{W.alert(`<div class="listener-details">
      <h3>监听器详情</h3>
      <p><strong>协议类型：</strong>${o.Type}</p>
      <p><strong>监听地址：</strong>${o.ListenAddress}</p>
      <p><strong>连接地址：</strong>${o.ConnectAddress}</p>
      <p><strong>当前状态：</strong>${o.Status===1?"运行中":"已停止"}</p>
    </div>`,"监听器详情",{dangerouslyUseHTMLString:!0,confirmButtonText:"确定",customClass:"details-dialog"})},ae=()=>{L.value=!1,F()},F=()=>{n.value={protocol:"websocket",listenAddress:"",connectAddress:""},_.value={endpoint:"oss-cn-hangzhou.aliyuncs.com",bucketName:"alisso"},v.value=0};return _e(async()=>{await g()}),(o,a)=>{const c=be,m=ge,P=ye,z=Ae,q=ke,V=Ce,oe=Se,M=Le,ne=Ve,y=Te,A=we,de=Pe,ce=ze,ie=Ee;return f(),E("div",Ge,[t("div",Xe,[Ye,e(m,{type:"primary",size:"large",class:"add-listener-btn",onClick:a[0]||(a[0]=l=>L.value=!0)},{default:s(()=>[e(c,null,{default:s(()=>[e(d($e))]),_:1}),b(" 添加监听器 ")]),_:1})]),t("div",Ze,[e(P,{class:"stat-card"},{default:s(()=>[t("div",je,[e(c,{class:"stat-icon total-icon"},{default:s(()=>[e(d(xe))]),_:1}),t("div",es,[t("div",ss,h(S.value.length),1),ts])])]),_:1}),e(P,{class:"stat-card"},{default:s(()=>[t("div",ls,[e(c,{class:"stat-icon active-icon"},{default:s(()=>[e(d(Ie))]),_:1}),t("div",as,[t("div",os,h(R.value),1),ns])])]),_:1}),e(P,{class:"stat-card"},{default:s(()=>[t("div",ds,[e(c,{class:"stat-icon inactive-icon"},{default:s(()=>[e(d(Ne))]),_:1}),t("div",cs,[t("div",is,h(G.value),1),rs])])]),_:1})]),e(P,{class:"listener-table-card"},{header:s(()=>[t("div",us,[_s,t("div",ps,[e(z,{content:"刷新列表",placement:"top"},{default:s(()=>[e(m,{type:"info",size:"small",onClick:g,loading:p.value},{default:s(()=>[e(c,null,{default:s(()=>[e(d(Be))]),_:1})]),_:1},8,["loading"])]),_:1})])])]),default:s(()=>[I((f(),w(oe,{data:S.value,class:"custom-table","empty-text":"暂无监听器数据"},{default:s(()=>[e(V,{prop:"Type",label:"协议类型",width:"120"},{default:s(({row:l})=>[t("div",vs,[e(q,{type:X(l.Type),class:"protocol-tag",effect:"light",round:""},{default:s(()=>[b(h(l.Type.toUpperCase()),1)]),_:2},1032,["type"])])]),_:1}),e(V,{prop:"ListenAddress",label:"监听地址","min-width":"180"},{default:s(({row:l})=>[t("div",ms,[e(c,{class:"address-icon"},{default:s(()=>[e(d(De))]),_:1}),t("div",fs,[t("div",hs,h(l.ListenAddress),1),bs])])]),_:1}),e(V,{prop:"ConnectAddress",label:"连接地址","min-width":"180"},{default:s(({row:l})=>[t("div",gs,[e(c,{class:"address-icon"},{default:s(()=>[e(d(U))]),_:1}),t("div",ys,[t("div",As,h(l.ConnectAddress),1),ks])])]),_:1}),e(V,{label:"状态",width:"120"},{default:s(({row:l})=>[t("div",Cs,[t("div",{class:N(["status-dot",{"status-active":l.Status===1,"status-inactive":l.Status===2}])},null,2),e(q,{type:l.Status===1?"success":"danger",size:"small",class:"status-tag",effect:"light"},{default:s(()=>[b(h(l.Status===1?"运行中":"已停止"),1)]),_:2},1032,["type"])])]),_:1}),e(V,{label:"操作",width:"200"},{default:s(({row:l})=>[t("div",Ss,[e(z,{content:l.Status===2?"启动监听器":"停止监听器",placement:"top"},{default:s(()=>[e(m,{size:"small",type:l.Status===2?"success":"primary",onClick:$=>l.Status===2?ee(l):se(l),icon:l.Status===2?d(Ue):d(Ke),circle:""},null,8,["type","onClick","icon"])]),_:2},1032,["content"]),e(z,{content:"删除监听器",placement:"top"},{default:s(()=>[e(m,{size:"small",type:"danger",onClick:$=>te(l),icon:d(Oe),circle:""},null,8,["onClick","icon"])]),_:2},1024),e(z,{content:"查看详情",placement:"top"},{default:s(()=>[e(m,{size:"small",type:"info",onClick:$=>le(l),icon:d(Fe),circle:""},null,8,["onClick","icon"])]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[ie,p.value]])]),_:1}),e(ce,{modelValue:L.value,"onUpdate:modelValue":a[9]||(a[9]=l=>L.value=l),title:"添加监听器",width:"560px",class:"add-listener-dialog","close-on-click-modal":!1},{footer:s(()=>[t("div",Us,[e(m,{onClick:ae,disabled:p.value},{default:s(()=>[b(" 取消 ")]),_:1},8,["disabled"]),v.value>0?(f(),w(m,{key:0,onClick:a[7]||(a[7]=l=>v.value--),disabled:p.value},{default:s(()=>[b(" 上一步 ")]),_:1},8,["disabled"])):B("",!0),v.value<1?(f(),w(m,{key:1,type:"primary",onClick:a[8]||(a[8]=l=>v.value++),disabled:!n.value.protocol},{default:s(()=>[b(" 下一步 ")]),_:1},8,["disabled"])):B("",!0),v.value===1?(f(),w(m,{key:2,type:"primary",onClick:O,loading:p.value,disabled:!K.value},{default:s(()=>[b(" 确认添加 ")]),_:1},8,["loading","disabled"])):B("",!0)])]),default:s(()=>[t("div",Ls,[e(ne,{active:v.value,"finish-status":"success",simple:"",class:"form-steps"},{default:s(()=>[e(M,{title:"协议选择"}),e(M,{title:"参数配置"})]),_:1},8,["active"]),e(de,{model:n.value,"label-width":"auto","label-position":"top",class:"listener-form",onSubmit:pe(O,["prevent"])},{default:s(()=>[I(t("div",Vs,[Ts,t("div",ws,[(f(),E(D,null,ve(Q,l=>t("div",{key:l.value,class:N(["protocol-card",{"protocol-selected":n.value.protocol===l.value}]),onClick:$=>Y(l.value)},[t("div",zs,[e(c,{class:N(l.iconClass)},{default:s(()=>[(f(),w(me(l.icon)))]),_:2},1032,["class"])]),t("div",Es,[t("div",$s,h(l.label),1),t("div",xs,h(l.description),1)])],10,Ps)),64))])],512),[[H,v.value===0]]),I(t("div",Is,[Ns,n.value.protocol==="oss"?(f(),E(D,{key:0},[e(A,{label:"EndPoint",required:""},{default:s(()=>[e(y,{modelValue:_.value.endpoint,"onUpdate:modelValue":a[1]||(a[1]=l=>_.value.endpoint=l),placeholder:"oss-cn-hangzhou.aliyuncs.com",clearable:"",size:"large"},{prepend:s(()=>[e(c,null,{default:s(()=>[e(d(J))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(A,{label:"AccessKeyId",required:""},{default:s(()=>[e(y,{modelValue:n.value.listenAddress,"onUpdate:modelValue":a[2]||(a[2]=l=>n.value.listenAddress=l),placeholder:"请输入AccessKeyId",clearable:"",size:"large"},{prepend:s(()=>[e(c,null,{default:s(()=>[e(d(qe))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(A,{label:"AccessKeySecret",required:""},{default:s(()=>[e(y,{modelValue:n.value.connectAddress,"onUpdate:modelValue":a[3]||(a[3]=l=>n.value.connectAddress=l),type:"password",placeholder:"请输入AccessKeySecret","show-password":"",clearable:"",size:"large"},{prepend:s(()=>[e(c,null,{default:s(()=>[e(d(Me))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(A,{label:"BucketName",required:""},{default:s(()=>[e(y,{modelValue:_.value.bucketName,"onUpdate:modelValue":a[4]||(a[4]=l=>_.value.bucketName=l),placeholder:"alisso",clearable:"",size:"large"},{prepend:s(()=>[e(c,null,{default:s(()=>[e(d(He))]),_:1})]),_:1},8,["modelValue"])]),_:1})],64)):(f(),E(D,{key:1},[e(A,{label:n.value.protocol==="oss"?"AccessKeyId":"监听地址",required:""},{default:s(()=>[e(y,{modelValue:n.value.listenAddress,"onUpdate:modelValue":a[5]||(a[5]=l=>n.value.listenAddress=l),placeholder:Z(),clearable:"",size:"large"},{prepend:s(()=>[e(c,null,{default:s(()=>[e(d(We))]),_:1})]),_:1},8,["modelValue","placeholder"]),Bs]),_:1},8,["label"]),e(A,{label:n.value.protocol==="oss"?"AccessKeySecret":"连接地址",required:""},{default:s(()=>[e(y,{modelValue:n.value.connectAddress,"onUpdate:modelValue":a[6]||(a[6]=l=>n.value.connectAddress=l),placeholder:j(),clearable:"",size:"large"},{prepend:s(()=>[e(c,null,{default:s(()=>[e(d(Je))]),_:1})]),_:1},8,["modelValue","placeholder"]),Ds]),_:1},8,["label"])],64))],512),[[H,v.value===1]])]),_:1},8,["model","onSubmit"])])]),_:1},8,["modelValue"])])}}});const js=re(Ks,[["__scopeId","data-v-351f43e4"]]);export{js as default};
