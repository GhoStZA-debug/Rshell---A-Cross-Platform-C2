import{_ as je}from"./f5f6aa45.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        */import"./4ed993c7.js";/* empty css        *//* empty css        */import{ax as fe,aB as Oe,r as v,e as Z,d as We,n as se,z as qe,w as Qe,l as d,m as D,p as r,V as l,P as n,Q as ee,O as y,a9 as He,U as k,T as u,S as E,u as c,J as ie,F as Xe,a8 as Ye,az as Ze,aA as et,W as tt}from"./95bbca75.js";import{C as $}from"./59206fab.js";import{c as at,a as m,b as U,d as lt,N as nt,v as ot,ar as st,as as it,at as rt,i as ct,K as dt,au as ut,Q as pt,f as ft,h as _t,J as mt,x as ht,av as re,D as vt,aj as yt,aw as gt,ax as ce,ay as kt,az as R,_ as de,A as ue,X as pe,aA as Ct,a5 as wt,a6 as bt,aB as Tt,I as xt,aC as Ft}from"./3325456c.js";const Dt=fe("globalFileTree",{state:()=>({dict:{}}),actions:{addEntry(p,C){if(!Array.isArray(C))throw new Error("Value must be an array");this.dict[p]=C},updateEntry(p,C){if(!Array.isArray(C))throw new Error("Value must be an array");this.dict.hasOwnProperty(p)||(this.dict[p]=[]),this.dict[p]=C},getEntry(p){return this.dict[p]||[]},removeEntry(p){delete this.dict[p]}}}),Et=fe("globalCurrentFileNode",{state:()=>({dict:{}}),actions:{setFileNode(p,C){C.trim()&&(this.dict[p]=C)},getFileNode(p){return this.dict[p]}}});const _e=p=>(Ze("data-v-799f1f27"),p=p(),et(),p),$t={class:"file-manager-container"},Pt={class:"toolbar"},Nt={class:"main-content"},Bt={class:"file-tree-panel"},zt={class:"panel-header"},It=_e(()=>r("span",null,"文件树",-1)),Vt={class:"tree-container"},Lt={class:"tree-node"},St=["onDblclick"],Mt={class:"node-name"},At={key:0,class:"file-size"},Ut={class:"empty-tree"},Rt=_e(()=>r("p",null,"空文件夹",-1)),Gt={class:"file-details-panel"},Kt={class:"path-navigation"},Jt={class:"file-list-container"},jt={key:0,class:"file-list-header"},Ot={class:"header-info"},Wt={class:"file-count"},qt={key:0},Qt={class:"header-actions"},Ht=["onClick"],Xt={class:"file-name"},Yt={key:0},Zt={key:1},ea={class:"action-buttons"},ta={key:0,class:"file-preview-panel"},aa={class:"preview-header"},la={class:"preview-actions"},na={class:"preview-content"},oa={__name:"ClientFiles",setup(p){const C=Oe(),g=String(C.query.uid);v(!1);const K=v(!1),L=v(!1),J=v(!1),G=v(null),w=v([]),h=v(null),S=v([]),z=v(null),I=v(""),P=v(null),j=v(null),M=v(""),T=v(""),b=v([]),N=v({key:"name",direction:"asc"}),O=Dt(),te=Et(),me={children:"children",label:"name"},he=Z(()=>{const e=t=>t.filter(a=>a.name!=="."&&a.name!=="..").map(a=>({...a,children:a.children?e(a.children):[]}));return e(w.value)}),ve=Z(()=>{var s;if(!((s=h.value)!=null&&s.path))return[];const t=h.value.path.split("/").filter(f=>f),a=[];let i="";return a.push({name:"根目录",path:"/"}),t.forEach((f,B)=>{i=B===0?`/${f}`:`${i}/${f}`,a.push({name:f,path:i})}),a}),ye=Z(()=>{const e=[...S.value];return(M.value?e.filter(a=>a.name.toLowerCase().includes(M.value.toLowerCase())):e).sort((a,i)=>{let s,f;switch(N.value.key){case"name":s=a.name.toLowerCase(),f=i.name.toLowerCase();break;case"size":s=a.type==="D"?-1:parseInt(a.size)||0,f=i.type==="D"?-1:parseInt(i.size)||0;break;case"time":s=new Date(a.modifiedTime).getTime(),f=new Date(i.modifiedTime).getTime();break;case"type":s=a.type+a.name.split(".").pop(),f=i.type+i.name.split(".").pop();break;default:return 0}const B=N.value.direction==="asc"?1:-1;return(s>f?1:-1)*B})}),ge=e=>{if(!e)return"-";const t=e.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4}) (\d{1,2}):(\d{1,2}):(\d{1,2})$/);if(t){const[a,i,s,f,B,H,X]=t;return new Date(f,s-1,i,B,H,X).toLocaleString("zh-CN")}try{const a=new Date(e);return isNaN(a.getTime())?e:a.toLocaleString("zh-CN")}catch{return e}},ke=e=>{const t=e.split(".").pop().toLowerCase();return{txt:"文本文件",pdf:"PDF文档",doc:"Word文档",docx:"Word文档",xls:"Excel表格",xlsx:"Excel表格",ppt:"PPT演示",pptx:"PPT演示",jpg:"JPEG图片",jpeg:"JPEG图片",png:"PNG图片",gif:"GIF图片",mp4:"MP4视频",avi:"AVI视频",mp3:"MP3音频",zip:"压缩文件",rar:"压缩文件"}[t]||"文件"},W=async e=>{K.value=!0;try{const t=await $.get_file_tree({uid:g,dirPath:e});t.data&&(w.value=t.data.data,O.updateEntry(g,w.value))}catch(t){console.error("Error fetching file tree:",t),at.error({title:"加载失败",message:"无法获取文件树数据"})}finally{K.value=!1}},Ce=async()=>{try{const e=await $.get_drives({uid:g});w.value=e.data.data,O.updateEntry(g,w.value),m.success("已切换到驱动器视图")}catch(e){console.error("Error fetching file tree:",e)}},x=async e=>{if(!(!e||e.trim()==="")){L.value=!0;try{await W(e);const t=q(e,w.value);if(t&&(h.value=t,S.value=t.children||[],te.setFileNode(g,t.path),T.value=t.path,t&&P.value)){await se(),P.value.setCurrentKey(t.path);const a=P.value.store.nodesMap[t.path];a&&(a.expanded=!0)}}catch{m.error("路径不存在或无法访问")}finally{L.value=!1}}},we=async e=>{e.type==="D"?await x(e.path):e.type==="F"&&await Q(e)},be=async e=>{e.type==="D"?await x(e.path):await Q(e)},Te=e=>{e.type==="D"?x(e.path):Q(e)},xe=e=>{e.expanded=!0},Fe=e=>{e.expanded=!1},q=(e,t)=>{if(!e)return null;const a=i=>{if(i.path===e)return i;if(i.children)for(const s of i.children){const f=a(s);if(f)return f}return null};if(Array.isArray(t))for(const i of t){const s=a(i);if(s)return s}else if(t)return a(t);return null},Q=async e=>{if(e.type==="F"){z.value=e,L.value=!0;try{const t=await $.fetch_file_content({uid:g,path:e.path});I.value=t.data.content}catch(t){console.error("Error fetching file content:",t),I.value="无法加载文件内容",m.error("文件读取失败")}finally{L.value=!1}}},De=()=>{z.value=null,I.value=""},Ee=async e=>{var a,i;const t=new FormData;t.append("file",e.raw),t.append("uploadPath",`${((a=h.value)==null?void 0:a.path)||"./"}/${e.name}`);try{(await $.upload_file({uid:g,file:e.raw,uploadPath:`${((i=h.value)==null?void 0:i.path)||"./"}/${e.name}`})).data.status===200&&(m.success(`${e.name} 开始上传`),await A())}catch{m.error("上传失败")}},$e=()=>!1,Pe=()=>{j.value&&j.value.$el.querySelector("input").click()},Ne=async e=>{if(!e){m.warning("请先选择文件夹位置");return}try{const{value:t}=await U.prompt("请输入新文件夹的名称","新建文件夹",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"文件夹名称",inputValidator:a=>a?/[<>:"/\\|?*]/.test(a)?"文件夹名称包含非法字符":!0:"文件夹名称不能为空"});if(!t)return;await $.make_dir({uid:g,dirPath:`${e}/${t}`}),m.success("创建成功"),await A()}catch(t){t!=="cancel"&&m.error("创建失败")}},Be=async e=>{try{await U.confirm(`确定删除 ${e.type==="F"?"文件":"文件夹"} "${e.name}" 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await $.delete_file({uid:g,filePath:e.path}),m.success("删除成功"),await A()}catch(t){t!=="cancel"&&m.error("删除失败")}},ze=async()=>{if(b.value.length!==0)try{J.value=!0;const e=`确定删除选中的 ${b.value.length} 个项目吗？`;await U.confirm(e,"批量删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});for(const t of b.value)await $.delete_file({uid:g,filePath:t.path});m.success(`成功删除 ${b.value.length} 个项目`),b.value=[],await A()}catch(e){e!=="cancel"&&m.error("删除失败")}finally{J.value=!1}},ae=async e=>{G.value=e.path;try{await U.confirm(`确定下载文件 "${e.name}" 吗？`,"下载确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}),(await $.download_file({uid:g,filePath:e.path})).data.status===200?m.success(`文件 "${e.name}" 开始后台下载`):m.error("下载失败")}catch(t){t!=="cancel"&&m.error("下载失败")}finally{G.value=null}},Ie=(e,t)=>{switch(e){case"copy":Ve(t.path);break;case"info":Le(t);break;case"delete":Be(t);break}},Ve=e=>{navigator.clipboard.writeText(e).then(()=>{m.success("已复制到剪贴板")}).catch(()=>{m.error("复制失败")})},Le=e=>{const t=`
    <div style="text-align: left;">
      <p><strong>名称：</strong>${e.name}</p>
      <p><strong>类型：</strong>${e.type==="D"?"文件夹":"文件"}</p>
      <p><strong>路径：</strong>${e.path}</p>
      <p><strong>大小：</strong>${e.type==="F"?e.size:"-"}</p>
      <p><strong>修改时间：</strong>${e.modifiedTime}</p>
    </div>
  `;U.alert(t,"文件信息",{dangerouslyUseHTMLString:!0,confirmButtonText:"确定"})},Se=e=>{b.value=e},Me=e=>{N.value.key===e?N.value.direction=N.value.direction==="asc"?"desc":"asc":(N.value.key=e,N.value.direction="asc")},A=async()=>{h.value?await x(h.value.path):await W("./")},Ae=()=>{x("/")},Ue=()=>{M.value=""},Re=()=>{h.value&&(T.value=h.value.path)};return We(async()=>{const e=O.getEntry(g);if(!e||e.length===0)await W("./");else{w.value=e;const t=te.getFileNode(g)||"./",a=q(t,w.value)||q("./",w.value);if(a&&(h.value=a,S.value=a.children||[],T.value=a.path,await se(),P.value)){P.value.setCurrentKey(a.path);const i=P.value.store.nodesMap[a.path];i&&(i.expanded=!0)}}}),qe(()=>{w.value=[],h.value=null,S.value=[],z.value=null,I.value="",b.value=[]}),Qe(()=>{var e;return(e=h.value)==null?void 0:e.path},e=>{e&&(T.value=e)}),(e,t)=>{const a=lt,i=nt,s=ot,f=st,B=it,H=Ft,X=rt,F=ft,le=_t,ne=ct,V=mt,Ge=ht,Ke=dt,Je=ut,oe=pt;return d(),D("div",$t,[r("div",Pt,[l(i,{modelValue:M.value,"onUpdate:modelValue":t[0]||(t[0]=o=>M.value=o),placeholder:"搜索文件或文件夹...",clearable:"",onClear:Ue,class:"search-input"},{prefix:n(()=>[l(a,null,{default:n(()=>[l(c(re))]),_:1})]),_:1},8,["modelValue"]),l(f,null,{default:n(()=>[l(s,{type:"primary",icon:c(vt),onClick:A},{default:n(()=>[u("刷新")]),_:1},8,["icon"]),l(s,{type:"success",icon:c(yt),onClick:Pe},{default:n(()=>[u("上传文件")]),_:1},8,["icon"]),l(s,{type:"warning",icon:c(gt),onClick:t[1]||(t[1]=o=>{var _;return Ne(((_=h.value)==null?void 0:_.path)||"./")})},{default:n(()=>[u("新建文件夹")]),_:1},8,["icon"]),l(s,{icon:c(ce),onClick:Ae},{default:n(()=>[u("根目录")]),_:1},8,["icon"]),l(s,{icon:c(kt),onClick:Ce},{default:n(()=>[u("驱动器")]),_:1},8,["icon"])]),_:1})]),r("div",Nt,[r("div",Bt,[r("div",zt,[l(a,null,{default:n(()=>[l(c(R))]),_:1}),It]),r("div",Vt,[ee((d(),y(B,{ref_key:"fileTreeRef",ref:P,data:he.value,props:me,"node-key":"path","highlight-current":!0,"expand-on-click-node":!1,"default-expand-all":!1,onNodeClick:we,onNodeExpand:xe,onNodeCollapse:Fe},{default:n(({node:o,data:_})=>{var Y;return[r("div",Lt,[r("span",{class:ie(["node-content",{"is-current":((Y=h.value)==null?void 0:Y.path)===_.path}]),onDblclick:sa=>be(_)},[_.type==="D"?(d(),y(a,{key:0,class:"folder-icon"},{default:n(()=>[o.expanded?(d(),y(c(R),{key:0})):(d(),y(c(de),{key:1}))]),_:2},1024)):(d(),y(a,{key:1,class:"file-icon"},{default:n(()=>[l(c(ue))]),_:1})),r("span",Mt,k(_.name),1)],42,St),_.type==="F"?(d(),D("span",At,k(_.size),1)):E("",!0)])]}),empty:n(()=>[r("div",Ut,[l(a,null,{default:n(()=>[l(c(R))]),_:1}),Rt])]),_:1},8,["data"])),[[oe,K.value]])])]),r("div",Gt,[r("div",Kt,[l(X,{separator:"/"},{default:n(()=>[(d(!0),D(Xe,null,Ye(ve.value,(o,_)=>(d(),y(H,{key:_,onClick:Y=>x(o.path)},{default:n(()=>[_===0?(d(),y(a,{key:0},{default:n(()=>[l(c(ce))]),_:1})):E("",!0),r("span",null,k(o.name),1)]),_:2},1032,["onClick"]))),128))]),_:1}),l(i,{modelValue:T.value,"onUpdate:modelValue":t[3]||(t[3]=o=>T.value=o),onKeyup:t[4]||(t[4]=He(o=>x(T.value),["enter"])),onBlur:Re,placeholder:"输入路径或按Enter跳转",class:"path-input"},{append:n(()=>[l(s,{icon:c(re),onClick:t[2]||(t[2]=o=>x(T.value))},null,8,["icon"])]),_:1},8,["modelValue"])]),r("div",Jt,[h.value?(d(),D("div",jt,[r("div",Ot,[r("h3",null,k(h.value.name),1),r("span",Wt,[u(" 共 "+k(S.value.length)+" 个项目 ",1),b.value.length>0?(d(),D("span",qt," (已选择 "+k(b.value.length)+" 个)",1)):E("",!0)])]),r("div",Qt,[b.value.length>0?(d(),y(s,{key:0,type:"danger",size:"small",onClick:ze,disabled:J.value},{default:n(()=>[l(a,null,{default:n(()=>[l(c(pe))]),_:1}),u(" 批量删除 ")]),_:1},8,["disabled"])):E("",!0),l(ne,{onCommand:Me},{dropdown:n(()=>[l(le,null,{default:n(()=>[l(F,{command:"name"},{default:n(()=>[u("按名称")]),_:1}),l(F,{command:"size"},{default:n(()=>[u("按大小")]),_:1}),l(F,{command:"time"},{default:n(()=>[u("按修改时间")]),_:1}),l(F,{command:"type"},{default:n(()=>[u("按类型")]),_:1})]),_:1})]),default:n(()=>[l(s,{size:"small"},{default:n(()=>[l(a,null,{default:n(()=>[l(c(Ct))]),_:1}),u(" 排序方式 ")]),_:1})]),_:1})])])):E("",!0),ee((d(),y(Ke,{data:ye.value,style:{width:"100%"},onSelectionChange:Se,onRowDblclick:Te,"empty-text":"该文件夹为空"},{default:n(()=>[l(V,{type:"selection",width:"55"}),l(V,{prop:"name",label:"名称","min-width":"200"},{default:n(({row:o})=>[r("div",{class:"file-item",onClick:_=>e.handleFileClick(o)},[l(a,{class:ie(["file-icon",o.type])},{default:n(()=>[o.type==="D"&&o.expanded?(d(),y(c(R),{key:0})):o.type==="D"?(d(),y(c(de),{key:1})):(d(),y(c(ue),{key:2}))]),_:2},1032,["class"]),r("span",Xt,k(o.name),1)],8,Ht)]),_:1}),l(V,{prop:"type",label:"类型",width:"100"},{default:n(({row:o})=>[l(Ge,{type:o.type==="D"?"warning":"info",size:"small"},{default:n(()=>[u(k(o.type==="D"?"文件夹":ke(o.name)),1)]),_:2},1032,["type"])]),_:1}),l(V,{prop:"size",label:"大小",width:"120",sortable:""},{default:n(({row:o})=>[o.type==="F"?(d(),D("span",Yt,k(o.size),1)):(d(),D("span",Zt,"-"))]),_:1}),l(V,{prop:"modifiedTime",label:"修改时间",width:"180",sortable:""},{default:n(({row:o})=>[u(k(ge(o.modifiedTime)),1)]),_:1}),l(V,{label:"操作",width:"180",fixed:"right"},{default:n(({row:o})=>[r("div",ea,[o.type==="F"?(d(),y(s,{key:0,type:"primary",size:"small",onClick:_=>ae(o),loading:G.value===o.path},{default:n(()=>[l(a,null,{default:n(()=>[l(c(wt))]),_:1})]),_:2},1032,["onClick","loading"])):E("",!0),o.type==="D"?(d(),y(s,{key:1,type:"success",size:"small",onClick:_=>e.navigateToFolder(o.path)},{default:n(()=>[l(a,null,{default:n(()=>[l(c(R))]),_:1})]),_:2},1032,["onClick"])):E("",!0),l(ne,{onCommand:_=>Ie(_,o)},{dropdown:n(()=>[l(le,null,{default:n(()=>[l(F,{command:"copy"},{default:n(()=>[l(a,null,{default:n(()=>[l(c(bt))]),_:1}),u(" 复制路径 ")]),_:1}),l(F,{command:"info"},{default:n(()=>[l(a,null,{default:n(()=>[l(c(Tt))]),_:1}),u(" 详细信息 ")]),_:1}),l(F,{command:"delete",divided:""},{default:n(()=>[l(a,null,{default:n(()=>[l(c(pe))]),_:1}),u(" 删除 ")]),_:1})]),_:1})]),default:n(()=>[l(s,{size:"small"},{default:n(()=>[l(a,null,{default:n(()=>[l(c(xt))]),_:1})]),_:1})]),_:2},1032,["onCommand"])])]),_:1})]),_:1},8,["data"])),[[oe,L.value]])]),I.value?(d(),D("div",ta,[r("div",aa,[r("h4",null,k(z.value.name),1),r("div",la,[l(s,{type:"primary",size:"small",onClick:t[5]||(t[5]=o=>ae(z.value)),loading:G.value===z.value.path},{default:n(()=>[u(" 下载 ")]),_:1},8,["loading"]),l(s,{size:"small",onClick:De},{default:n(()=>[u("关闭")]),_:1})])]),r("div",na,[r("pre",null,k(I.value),1)])])):E("",!0)])]),ee(l(Je,{ref_key:"uploadRef",ref:j,action:"",limit:5,multiple:!0,"file-list":e.fileList,"on-change":Ee,"before-upload":$e,"auto-upload":!1},null,8,["file-list"]),[[tt,!1]])])}}},ya=je(oa,[["__scopeId","data-v-799f1f27"]]);export{ya as default};
